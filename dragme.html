<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<title>Drag Me!</title>
<style>
  * { box-sizing: border-box; }
  body { height: 100dvh; margin: 0; font-family: system-ui, sans-serif; }
  .stage {
    position: relative; width: 100%; height: 100%;
    background: #f5f7fb; user-select: none; overflow: hidden;
  }
  #box {
    position: absolute; left: 180px; top: 180px;
    width: 200px; height: 120px;
    background: #4f8cff; color: #fff; display: grid; place-items: center;
    border-radius: 14px; cursor: grab; touch-action: none;
    box-shadow: 0 10px 24px rgba(0,0,0,.12);
    z-index: 10;
  }
  #box.dragging { cursor: grabbing; }
  .swatch {
    position: absolute; width: 120px; height: 120px; border-radius: 16px;
    display: grid; place-items: center; color: #fff; font-weight: 600;
    box-shadow: 0 6px 16px rgba(0,0,0,.12);
    transition: transform .12s ease, box-shadow .12s ease;
  }
  .swatch::after{
    content: attr(data-name);
    text-shadow: 0 1px 2px rgba(0,0,0,.25);
  }
  .swatch.active{
    transform: scale(1.06);
    box-shadow: 0 10px 28px rgba(0,0,0,.18);
    outline: 3px solid rgba(255,255,255,.8);
  }
  .swatch.red   { background:#ff4d4f; left: 24px;  top: 50%; transform: translateY(-50%); }
  .swatch.green { background:#52c41a; right:24px;  top: 50%; transform: translateY(-50%); }
</style>
</head>
<body>
  <div class="stage" id="stage">
    <div class="swatch red"   data-color="#ff4d4f" data-name="Red"></div>
    <div class="swatch green" data-color="#52c41a" data-name="Green"></div>
    <div id="box">Drag Me!</div>
  </div>
<script>
(() => {
  const box   = document.getElementById('box');
  const stage = document.getElementById('stage');
  const swatches = Array.from(document.querySelectorAll('.swatch'));
  let dragging = false;
  let startDX = 0, startDY = 0;
  let boxX = parseFloat(getComputedStyle(box).left) || 0;
  let boxY = parseFloat(getComputedStyle(box).top)  || 0;
  const isIntersecting = (a, b) =>
    !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
  function highlightOnOverlap() {
    const b = box.getBoundingClientRect();
    let matched = null;
    swatches.forEach(s => {
      const r = s.getBoundingClientRect();
      const hit = isIntersecting(b, r);
      s.classList.toggle('active', hit);
      if (hit) matched = s;
    });
    if (matched) {
      const color = matched.dataset.color;
      box.style.background = color;
    }
  }
  box.addEventListener('pointerdown', (e) => {
    dragging = true;
    box.classList.add('dragging');
    box.setPointerCapture(e.pointerId);
    const st = stage.getBoundingClientRect();
    startDX = e.clientX - st.left - boxX;
    startDY = e.clientY - st.top  - boxY;
  });
  box.addEventListener('pointermove', (e) => {
    if (!dragging) return;
    const st = stage.getBoundingClientRect();
    let nextX = e.clientX - st.left - startDX;
    let nextY = e.clientY - st.top  - startDY;
    const br = box.getBoundingClientRect();
    const maxX = st.width  - br.width;
    const maxY = st.height - br.height;
    boxX = Math.max(0, Math.min(nextX, maxX));
    boxY = Math.max(0, Math.min(nextY, maxY));
    box.style.left = boxX + 'px';
    box.style.top  = boxY + 'px';
    highlightOnOverlap();
  });
  function endDrag() {
    dragging = false;
    box.classList.remove('dragging');
    swatches.forEach(s => s.classList.remove('active'));
  }
  box.addEventListener('pointerup', endDrag);
  box.addEventListener('pointercancel', endDrag);
})();
</script>
</body>
</html>
